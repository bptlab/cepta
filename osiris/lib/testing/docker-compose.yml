version: '3.2'

services:
  # https://github.com/wurstmeister/zookeeper-docker
  zookeeper:
    # container_name: zookeeper
    image: wurstmeister/zookeeper:latest
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
    ports:
    - "2181:2181"

  # https://hub.docker.com/r/confluentinc/cp-kafka/
  kafka:
    # container_name: kafka
    # image: wurstmeister/kafka:latest
    image: confluentinc/cp-kafka
    environment:
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9093,BROKER://0.0.0.0:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: BROKER:PLAINTEXT,PLAINTEXT:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: BROKER
      # KAFKA_BROKER_ID: "1"
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: "1"
      KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS: "1"
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: "0"
      KAFKA_ADVERTISED_LISTENERS: "PLAINTEXT://localhost:35659,BROKER://172.17.0.1:9092"
      # KAFKA_ADVERTISED_LISTENERS: "PLAINTEXT://localhost:35659,BROKER://192.168.80.2:9092"
      # KAFKA_LOG_FLUSH_INTERVAL_MESSAGES": fmt.Sprintf("%d", int(^uint(0)>>1)),
      ## the >- used below infers a value which is a string and properly 
      ## ignore the multiple lines resulting in one long string: 
      ## https://yaml.org/spec/1.2/spec.html
      # KAFKA_ADVERTISED_LISTENERS: >- 
      #  LISTENER_DOCKER_INTERNAL://kafka:19092, 
      #  LISTENER_DOCKER_EXTERNAL://192.168.1.7:9092

      #KAFKA_LISTENERS: >-
      #  LISTENER_DOCKER_INTERNAL://:19092,
      #  LISTENER_DOCKER_EXTERNAL://:9092

      #KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: >- 
      #  LISTENER_DOCKER_INTERNAL:PLAINTEXT,
      #  LISTENER_DOCKER_EXTERNAL:PLAINTEXT

      # KAFKA_ADVERTISED_HOST_NAME: 192.168.1.7
      # KAFKA_CREATE_TOPICS: "test:1:1"
      # KAFKA_ADVERTISED_HOST_NAME: localhost
      # KAFKA_INTER_BROKER_LISTENER_NAME: LISTENER_DOCKER_INTERNAL
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_LOG4J_LOGGERS: >- 
        kafka.controller=INFO,
        kafka.producer.async.DefaultEventHandler=INFO,
        state.change.logger=INFO

    ports:
    - 35659:9093
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock